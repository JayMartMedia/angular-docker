# Angular Docker Overview

The purpose of this repo is to demonstrate how to run a production Angular app in a Docker container.

This guide will show you:
1. The files needed to run the Angular app in Docker
2. How to build the image
3. How to run the image

## Tools needed
- Docker Desktop - To build and run the Docker image (https://www.docker.com/products/docker-desktop/)
- NPM and Node - Just kidding, these aren't actually required since everything will be built directly in Docker!

# Setting up the app
## App starting point

This Angular project itself was generated by using `ng new` (https://angular.io/guide/setup-local), and then a few extra pages were added to show that routing still works.

## Files needed to run the Angular app in Docker

If you are containerizing your own Angular app, here are the files that you will most likely need. There may be some slight changes, for example the project name will need to be updated in the Dockerfile (line 15).

If you are working with a project that uses a private NPM registry you may need to setup a .npmrc file. This is relatively common when working on a project for a corporation/enterprise since they often use a private registry for security purposes.

You can view and copy these files from this project:

- **Dockerfile** - Tells Docker the commands it should run in order to build the image
- **.dockerignore** - Tells Docker not to copy certain files/directories from the host machine, (for example, node_modules, or the dist folder) since they will be generated inside the container as the image is building
- **nginx.conf** - Configures the nginx web-server to work with the Angular single-page application, by default nginx expects to use file based routing

# Building the Docker image

Once all the files are in place, you can build the docker image using the Dockerfile.

In your terminal, build the image by running:
```sh
docker build -t angular-docker:1.0 .
```
- By default Docker uses the Dockerfile in the current directory, alternatively you could use the file option to explicitly use a dockerfile with a different name (for example: `-f Dockerfile.debug`)
- `-t angular-docker:1.0` tells docker to give the image the name of `angular-docker` and the tag of `1.0`
- `.` (period) tells docker to use the current directory as the build context, this is the directory used when using the `COPY` command inside the Dockerfile

Once the `docker build` command from above has run, you can see the Docker image that you built by running:
```sh
docker images
```

The output should be somewhat similar to:
```sh
$ docker images
REPOSITORY                   TAG       IMAGE ID       CREATED        SIZE
angular-docker               1.0       ec182580e1ca   2 seconds ago    142MB
```

Extra documentation from Docker: https://docs.docker.com/engine/reference/commandline/build/
# Running the Docker image as a container

Now that the image is built, it is time to run it.

In your terminal, run the image by running:
```sh
docker run -d -p 1234:80 angular-docker:1.0
```
- `-d` tells docker to detach after starting the container (this allows you to continue using the same terminal instance)
- `-p 1234:80` tells docker to send traffic from port 1234 on the host machine to port 80 in the container, this sends traffic to the nginx web-server running in the container
- `angular-docker:1.0` is the image name and tag that the image was givin during the `docker build` command

The run command should return some hash string of characters, this is the container id of the newly created container.

View a list of all your running containers by running:
```sh
docker ps
```

The output should be somewhat similar to:
```sh
$ docker ps
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS         PORTS                  NAMES
71e2fca987d2   angular-docker:1.0   "/docker-entrypoint.â€¦"   2 minutes ago   Up 2 minutes   0.0.0.0:1234->80/tcp   sad_tesla
```

You should now be able to view the app at http://localhost:1234

## Stopping the container

To stop the container, you will need the container id, which you can get by running `docker ps` as shown above.

You can stop the container by running (replace 71e2... with your container id):
```sh
docker stop 71e2fca987d2
```
You can verify that the container was stopped by running `docker ps`

# Extra Info

## Running on host machine

Configuring the app to run in Docker does not break the apps normal development behavior that you may be familiar with. You can still run the hot-reload developer friendly version of the app on the host machine. This gives a much more pleasant developer experience since you don't have to manually restart the app every time you make a change.

Run `ng serve` for a dev server. Navigate to `http://localhost:4200/`. The application will automatically reload if you change any of the source files.

You will need NPM and Node installed to run the app on the host machine.